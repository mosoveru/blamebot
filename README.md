# Blamebot 

Телеграм бот с уведомлениями о событиях, произошедших в удалённом реестре репозиториев.

## Требования

- Установленный Docker Daemon

## Установка

Для запуска приложения необходимо заполнить `.env` файл начальными данными. 

Выполните команду на вашем сервере, чтобы скачать заготовку:

```bash
curl -Ls https://raw.githubusercontent.com/mosoveru/blamebot/refs/heads/main/.env.example -o .env
```

Далее вам нужно узнать ваш ID вашего телеграм клиента. Этот клиент будет администратором и сможет управлять созданием инстансов в приложении.

Узнать свой Telegram User ID можно через бота `@getmyid_bot`. Ваш ID запишите в ключ `TG_ADMIN_ID` в `.env` файле.

Следующее, сгенерируйте приватный ключ для JWT токенов. Воспользуйтесь этим [сервисом](https://www.md5hashgenerator.com/). Полученное значение запишите в ключ `PRIVATE_JWT_KEY` в `.env` файле.

С помощью `@BotFather` создайте своего бота. Скопируйте уникальный токен, который вы получите после создания бота, в ключ `BOT_SECRET_TOKEN` в `.env` файле.

По желанию, вы можете поменять пароль о суперпользователя Postgres в `POSTGRES_PASSWORD`, а также пароль от базы данных для самого пользователя `blamebot_admin` в `DB_USER_PASSWORD`.

Практически всё готово к установке. Скачайте заготовку `docker-compose.yaml` файла:

```bash
curl -Ls https://raw.githubusercontent.com/mosoveru/blamebot/refs/heads/main/docker-compose.prod.yaml -o docker-compose.yaml
```

И запустите приложение с помощью:

```bash
docker compose up -d
```

## Использование

В интерфейсе админа в вашем телеграм боте вы можете создать новый инстанс. При создании потребуется URL вашего инстанса. Использовать более одного раза один и тот же URL нельзя.

**Важно: сообщите команде, какой URL вы используете. Этот URL будет использоваться при связывании клиента и приложения.**

При создании инстанса вы получите JWT токен. Вставьте его в Secret Token при создании Webhook в вашем репозитории. Используйте один и тот же JWT токен для всех репозиториев в вашем развёрнутом инстансе GitLab. 

На данный момент, поддерживается **только Issue Hook GitLab** типы событий в Webhook.

В адресе при создании webhook в GitLab используйте следующий формат адреса:

```
http://<hostname>:3000/webhook
```

Порт может быть отличный от стандартного `3000`, если вы поменяли значение `HTTP_SERVER_PORT` в `.env` файле. Указание ресурса `/webhook` **обязательно**.